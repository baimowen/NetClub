hostname ROUTER2
ip routing

! link to route1
! switchport: L2 vlan
! no switchport: L3 route
! (config) show interfaces status
interface Ethernet1
  no switchport
  ip address 172.16.0.2/24
  no shutdown
  ! bind on interface
  ! control the flow before it leaves the interface
  ip access-group ACL_TO_R2 out
  ! (config) show running-config interface DEV

! trunk ports
! child interface can not auto enable parent interfece
! (config) show ip interface brief
interface Ethernet2
  no switchport
  no ip address
  no shutdown

interface Ethernet2.10
  encapsulation dot1q vlan 10
  ip address 192.168.10.1/24
  no shutdown

interface Ethernet2.20
  encapsulation dot1q vlan 20
  ip address 192.168.20.1/24
  no shutdown

interface Ethernet2.30
  encapsulation dot1q vlan 30
  ip address 192.168.30.1/24
  no shutdown
  ! bind on interface
  ! control the flow before it enters the interface
  ip access-group ACL_TO_30 out

! OSPF
! (config) show ip ospf neighbor
router ospf 1
  router-id 2.2.2.2
  network 172.16.0.0/24 area 0
  network 192.168.10.0/24 area 0
  network 192.168.20.0/24 area 0
  network 192.168.30.0/24 area 0

! ACL
! route1 ---> route2(Eth1)
!           ↑
!           in
! route2(Eth1) ---> route1
!             ↓
!            out
! control `who can i access?`	      enter the interface	   in
! control `who can i	send it to?`  leave the interface 	 out
! (config) show ip access-lists
ip access-list extended ACL_TO_30
  ! permit/deny ip SRCADDR DSTADDR
  ! wildcard mask
  permit ip 192.168.10.0 0.0.0.255 192.168.30.0 0.0.0.255
  deny   ip 192.168.20.0 0.0.0.255 192.168.30.0 0.0.0.255
  ! CIDR mask
  ! permit ip 192.168.10.0/24 192.168.30.0/24
  ! deny   ip 192.168.20.0/24 192.168.30.0/24
  ! permit ip any any

ip access-list extended ACL_TO_R2
  permit ip 172.16.0.0 0.0.0.255 192.168.0.0 0.0.255.255
  deny   ip 192.168.0.0 0.0.255.255 172.16.0.0 0.0.0.255
  ! permit ip 172.16.0.0/24 192.168.0.0/16
  ! deny   ip 192.168.0.0/16 172.16.0.0/24
  ! permit ip any any
