name: test
prefix: ""
topology:
  nodes:
    route1:
      kind: arista_ceos
      image: arista/ceos:4.32.0F
      startup-config: config/route1.cfg
      exec:
        - sysctl net.ipv4.ip_forward=1

    route2:
      kind: arista_ceos
      image: arista/ceos:4.32.0F
      startup-config: config/route2.cfg
      exec:
        - sysctl net.ipv4.ip_forward=1

    switch:
      kind: arista_ceos
      image: arista/ceos:4.32.0F
      startup-config: config/switch.cfg

    nodeA:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iptables
        - ip addr add 192.168.10.2/24 dev eth1
        - ip link set eth1 up
        - ip route replace default via 192.168.10.1

    nodeB:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iptables
        - ip addr add 192.168.20.2/24 dev eth1
        - ip link set eth1 up
        - ip route replace default via 192.168.20.1

    nodeC:
      kind: linux
      image: alpine:latest
      exec:
        - apk add --no-cache iproute2 iptables
        - ip addr add 192.168.30.2/24 dev eth1
        - ip link set eth1 up
        - ip route replace default via 192.168.30.1

    # node:
    #   kind: linux
    #   image: alpine:latest

  links:
    - endpoints: ["route1:eth1","route2:eth1"]
    - endpoints: ["route2:eth2","switch:eth1"]
    - endpoints: ["switch:eth2","nodeA:eth1"]
    - endpoints: ["switch:eth3","nodeB:eth1"]
    - endpoints: ["switch:eth4","nodeC:eth1"]

###############################################
# route1(eth1) <-> route2(eth1)               #
# route2(eth2) <-trunk allowed-> switch(eth1) #
# switch(eth2) <-access vlan 10-> nodeA(eth1) #
# switch(eth3) <-access vlan 20-> nodeB(eth1) #
# switch(eth4) <-access vlan 30-> nodeC(eth1) #
###############################################
# route1: 172.16.0.1/24
# route2: 192.168.0.0/16
# nodeA: vlan10 192.168.10.2/24
# nodeB: vlan20 192.168.20.2/24
# nodeC: vlan30 192.168.30.2/24
